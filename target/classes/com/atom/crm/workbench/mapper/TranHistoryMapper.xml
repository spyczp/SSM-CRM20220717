<?xml version="1.0" encoding="UTF-8" ?> <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.atom.crm.workbench.mapper.TranHistoryMapper">
    <resultMap id="BaseResultMap" type="com.atom.crm.workbench.bean.TranHistory">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Aug 25 08:52:54 CST 2022.
        -->
        <id column="id" jdbcType="CHAR" property="id" />
        <result column="stage" jdbcType="VARCHAR" property="stage" />
        <result column="money" jdbcType="VARCHAR" property="money" />
        <result column="expected_date" jdbcType="CHAR" property="expectedDate" />
        <result column="create_time" jdbcType="VARCHAR" property="createTime" />
        <result column="create_by" jdbcType="CHAR" property="createBy" />
        <result column="tran_id" jdbcType="CHAR" property="tranId" />
    </resultMap>
    <sql id="Base_Column_List">
        <!--
          WARNING - @mbggenerated
          This element is automatically generated by MyBatis Generator, do not modify.
          This element was generated on Thu Aug 25 08:52:54 CST 2022.
        -->
        id,
        stage,
        money,
        expected_date,
        create_time,
        create_by,
        tran_id
    </sql>

    <select id="selectTranHistoryListByTranId" parameterType="String" resultMap="BaseResultMap">
        select
            th.id,
            dv.value as stage,
            th.money,
            th.expected_date,
            th.create_time,
            u.name as create_by,
            th.tran_id
        from tbl_tran_history th
        join tbl_dic_value dv
        on th.stage=dv.id
        join tbl_user u
        on th.create_by=u.id
        where th.tran_id=#{tranId}
        order by th.create_time
    </select>

    <insert id="insertATranHistory" parameterType="TranHistory">
        insert into tbl_tran_history
        values(
          #{id},
          #{stage},
          #{money},
          #{expectedDate},
          #{createTime},
          #{createBy},
          #{tranId}
              )
    </insert>
</mapper>